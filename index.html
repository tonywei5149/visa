<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agentå¯¹è¯é¡µé¢</title>
  <style>
    /* åŸºç¡€æ ·å¼é‡ç½® */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #fff;
      color: #333;
      height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.5;
    }

    /* ä¸»å®¹å™¨æ ·å¼ */
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      padding-bottom: 80px; /* ä¸ºåº•éƒ¨è¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
    }

    /* DebugåŒºåŸŸæ ·å¼ */
    .debug-toggle {
      cursor: pointer;
      user-select: none;
      padding: 6px 12px;
      background-color: #f0f0f0;
      border-radius: 8px;
      margin-bottom: 15px;
      display: inline-block;
      font-size: 14px;
      transition: background-color 0.2s;
      color: #555;
    }

    .debug-toggle:hover {
      background-color: #e0e0e0;
    }

    .debug-area {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      white-space: pre-wrap;
      overflow-x: auto;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 12px;
      color: #444;
      max-height: 300px;
      overflow-y: auto;
    }

    /* æ¶ˆæ¯è¾“å‡ºåŒºåŸŸæ ·å¼ */
    .output-area {
      flex: 1;
      width: 100%;
      background-color: #fff;
      border-radius: 8px;
      overflow-y: auto;
      padding: 10px 0;
      position: relative; /* ç¡®ä¿ç›¸å¯¹å®šä½ */
      scroll-behavior: smooth; /* å¹³æ»‘æ»šåŠ¨ */
    }

    /* æ¶ˆæ¯æ ·å¼ */
    .message {
      margin: 0 auto 15px;
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 100%;
      background-color: #f9f9f9;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      white-space: pre-wrap;
      overflow-wrap: break-word;
      word-break: break-word;
      width: 100%;
    }

    /* æœ€æ–°æ¶ˆæ¯æ ·å¼ */
    .message.latest {
      background-color: #ffffc0;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
    }

    /* æ¶ˆæ¯å†…å®¹æ ·å¼ */
    .message-content p {
      margin: 0 0 12px 0;
    }

    .message-content p:last-child {
      margin-bottom: 0;
    }

    /* ä»£ç å—æ ·å¼ */
    .code-block {
      background-color: #f5f5f5;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: monospace;
      margin: 8px 0;
      border-left: 3px solid #ddd;
    }

    /* è¾“å…¥å®¹å™¨æ ·å¼ */
    .input-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #fff;
      padding: 15px;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }

    /* æ¶ˆæ¯è¡¨å•æ ·å¼ */
    #message-form {
      display: flex;
      align-items: center;
      max-width: 800px;
      margin: 0 auto;
    }

    /* è¾“å…¥æ¡†æ ·å¼ */
    #user-input {
      flex: 1;
      height: 44px;
      padding: 0 16px;
      border: 1px solid #ddd;
      border-radius: 22px;
      outline: none;
      font-size: 16px;
      background-color: #f9f9f9;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    #user-input:focus {
      border-color: #ccc;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05);
    }

    /* æŒ‰é’®é€šç”¨æ ·å¼ */
    button {
      background-color: #f0f0f0;
      color: #333;
      border: none;
      border-radius: 22px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    button:hover {
      background-color: #e0e0e0;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* åˆ·æ–°æŒ‰é’®æ ·å¼ */
    #refresh-button {
      width: 44px;
      height: 44px;
      margin-right: 10px;
    }

    /* å‘é€æŒ‰é’®æ ·å¼ */
    #send-button {
      width: 80px;
      height: 44px;
      margin-left: 10px;
    }

    /* æ ‡ç­¾æ ·å¼ */
    .message-label {
      display: inline-block;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }

    /* è¿›åº¦æŒ‡ç¤ºå™¨ */
    .loading-indicator {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-top-color: #333;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 600px) {
      .container {
        padding: 15px;
        padding-bottom: 70px;
      }
      
      .message {
        padding: 10px 14px;
        margin-bottom: 12px;
      }
      
      .input-container {
        padding: 10px;
      }
      
      #user-input {
        height: 40px;
        font-size: 15px;
      }
      
      #refresh-button {
        width: 40px;
        height: 40px;
      }
      
      #send-button {
        width: 70px;
        height: 40px;
        font-size: 14px;
      }
    }

    /* æ€è€ƒä¸­æ¶ˆæ¯æ ·å¼ */
    .thinking-message {
      display: flex;
      flex-direction: column;
      background-color: #f8f8f8;
      border: 1px solid #eee;
    }

    .thinking-content {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }

    /* æ€è€ƒç‚¹æ ·å¼ */
    .thinking-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #888;
      margin-right: 4px;
      animation: thinking 1.4s infinite ease-in-out;
    }

    .thinking-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .thinking-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .thinking-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes thinking {
      0%, 80%, 100% { 
        transform: scale(0.6);
        opacity: 0.6;
      }
      40% { 
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="debug-toggle" id="toggle-debug">æ˜¾ç¤ºDebugä¿¡æ¯ â–¼</div>
    <div id="debug" class="debug-area"></div>
    <div id="output" class="output-area"></div>
    <textarea id="hidden-result" style="display: none;"></textarea>
  </div>
  
  <div class="input-container">
    <form id="message-form">
      <button type="button" id="refresh-button" title="æ¸…ç©ºèŠå¤©è®°å½•">ğŸ”„</button>
      <input type="text" id="user-input" placeholder="è¯·è¾“å…¥å†…å®¹..." autocomplete="off">
      <button type="submit" id="send-button">å‘é€</button>
    </form>
  </div>

  <script>
    // === é…ç½®éƒ¨åˆ† - å¯ä¿®æ”¹çš„APIåœ°å€å’Œtoken ===
    const CONFIG = {
      API_URL: 'https://api.coze.cn/open_api/v2/chat',
      API_TOKEN: 'pat_AeTwjaTKIbmVRypZPaibeYR0mpsIeCpW9BeQ88YChOQIvz9jaP5VtfJiLqy6SQY9',
      BOT_ID: '7497535849639854095'
    };

    // DOMå…ƒç´ è·å–
    const messageForm = document.getElementById('message-form');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const refreshButton = document.getElementById('refresh-button');
    const outputArea = document.getElementById('output');
    const hiddenResult = document.getElementById('hidden-result');
    const debugArea = document.getElementById('debug');
    const toggleDebug = document.getElementById('toggle-debug');

    // æ·»åŠ å†·å´æ—¶é—´å˜é‡
    let cooldownActive = false;
    
    // æ¶ˆæ¯å†å²æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰æ¶ˆæ¯
    const messageHistory = [];
    // æœ€å¤§æ¶ˆæ¯è®°å½•æ•°
    const MAX_MESSAGES = 50;

    // DebugåŒºåŸŸæ˜¾ç¤ºåˆ‡æ¢
    toggleDebug.addEventListener('click', () => {
      if (debugArea.style.display === 'none') {
        debugArea.style.display = 'block';
        toggleDebug.textContent = 'éšè—Debugä¿¡æ¯ â–²';
      } else {
        debugArea.style.display = 'none';
        toggleDebug.textContent = 'æ˜¾ç¤ºDebugä¿¡æ¯ â–¼';
      }
    });

    // ç®€åŒ–æ»šåŠ¨å‡½æ•°ï¼Œåªåœ¨ç‰¹å®šæ—¶æœºè§¦å‘ä¸€æ¬¡
    function scrollToBottom() {
      setTimeout(() => {
        outputArea.scrollTop = outputArea.scrollHeight;
        console.log('æ‰§è¡Œæ»šåŠ¨åˆ°åº•éƒ¨');
      }, 100);
    }

    // æ›´æ–°CSSæ ·å¼ï¼Œä¿æŒæ»šåŠ¨åŠŸèƒ½ä½†é¿å…å¹²æ‰°æ‰‹åŠ¨æ»šåŠ¨
    function updateScrollStyles() {
      const styleElement = document.createElement('style');
      styleElement.textContent = `
        body {
          overflow: hidden; /* é˜²æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ */
        }
        
        .container {
          display: flex;
          flex-direction: column;
          height: calc(100vh - 80px); /* ä¸ºè¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
          overflow: hidden;
        }
        
        .output-area {
          flex: 1;
          overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
          padding: 10px 0;
          position: relative;
          scroll-behavior: smooth; /* å¹³æ»‘æ»šåŠ¨ */
          -webkit-overflow-scrolling: touch; /* å¢å¼ºiOSæ»šåŠ¨ */
          max-height: calc(100vh - 150px); /* é€‚åº”å±å¹•é«˜åº¦ */
        }
        
        .input-container {
          position: fixed;
          bottom: 0;
          left: 0;
          width: 100%;
          background-color: #fff;
          padding: 15px;
          box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
          z-index: 1000;
        }
      `;
      document.head.appendChild(styleElement);
    }

    // ä¿®æ”¹addMessageToHistoryå‡½æ•°ï¼Œä»…åœ¨æœ«å°¾è§¦å‘ä¸€æ¬¡æ»šåŠ¨
    function addMessageToHistory(messageText) {
      console.log('æ·»åŠ æ¶ˆæ¯åˆ°å†å²:', messageText);
      
      // ç§»é™¤ä¹‹å‰çš„"æœ€æ–°"æ ‡è¯†
      const previousLatestMessages = document.querySelectorAll('.message.latest');
      previousLatestMessages.forEach(msg => {
        msg.classList.remove('latest');
      });
      
      // åˆ›å»ºæ–°æ¶ˆæ¯å…ƒç´ 
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', 'latest');
      
      // åŒºåˆ†é—®é¢˜å’Œå›ç­”
      if (messageText.startsWith('ã€é—®ã€‘')) {
        // åˆ›å»ºæ ‡ç­¾
        const label = document.createElement('div');
        label.className = 'message-label';
        label.textContent = 'é—®é¢˜';
        messageElement.appendChild(label);
        
        // æ·»åŠ æ¶ˆæ¯å†…å®¹
        messageElement.appendChild(document.createTextNode(messageText.substring('ã€é—®ã€‘'.length)));
      } else if (messageText.startsWith('ã€ç­”ã€‘')) {
        // æå–ã€ç­”ã€‘å‰ç¼€ä¹‹åçš„å†…å®¹ï¼Œä¸æ·»åŠ "å›ç­”"æ ‡ç­¾
        const answerText = messageText.substring('ã€ç­”ã€‘'.length);
        
        // åˆ›å»ºå†…å®¹å®¹å™¨
        const contentContainer = document.createElement('div');
        contentContainer.className = 'message-content';
        
        // å¤„ç†Markdownæ ¼å¼
        let formattedText = answerText
          // å¤„ç†æ®µè½
          .replace(/\n\n/g, '</p><p>')
          // å¤„ç†å•è¡Œæ¢è¡Œ
          .replace(/\n/g, '<br>')
          // å¤„ç†ç²—ä½“
          .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
          .replace(/__(.*?)__/g, '<strong>$1</strong>')
          // å¤„ç†æ–œä½“
          .replace(/\*([^*]+)\*/g, '<em>$1</em>')
          .replace(/_([^_]+)_/g, '<em>$1</em>');
        
        // å¤„ç†åˆ—è¡¨é¡¹
        if (formattedText.includes('- ')) {
          formattedText = '<p>' + formattedText.replace(/- (.*?)(?=<br>|$)/g, 'â€¢ $1') + '</p>';
        } else {
          formattedText = '<p>' + formattedText + '</p>';
        }
        
        contentContainer.innerHTML = formattedText;
        
        // å¤„ç†å¯èƒ½çš„ä»£ç /å‘½ä»¤æ ·å¼
        const paragraphs = contentContainer.querySelectorAll('p');
        paragraphs.forEach(p => {
          if (p.textContent.trim().startsWith('`') && p.textContent.trim().endsWith('`')) {
            p.innerHTML = p.innerHTML.replace(/`([^`]+)`/g, '<code>$1</code>');
            p.classList.add('code-block');
          }
        });
        
        messageElement.appendChild(contentContainer);
      } else {
        // ç³»ç»Ÿæ¶ˆæ¯æˆ–å…¶ä»–ç±»å‹
        messageElement.textContent = messageText;
      }
      
      // æ·»åŠ åˆ°ç•Œé¢
      outputArea.appendChild(messageElement);
      
      // æ·»åŠ åˆ°å†å²è®°å½•
      messageHistory.push(messageText);
      
      // å¦‚æœè¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œåˆ é™¤æœ€æ—©çš„æ¶ˆæ¯
      if (messageHistory.length > MAX_MESSAGES) {
        messageHistory.shift();
        if (outputArea.firstChild) {
          outputArea.removeChild(outputArea.firstChild);
        }
      }
      
      // æ·»åŠ æ–°æ¶ˆæ¯ååªæ»šåŠ¨ä¸€æ¬¡
      scrollToBottom();
    }

    // å‘é€æ¶ˆæ¯çš„å‡½æ•°
    async function sendMessage(message) {
      // å¦‚æœæ­£åœ¨å†·å´ä¸­ï¼Œåˆ™ä¸å¤„ç†
      if (cooldownActive) return;
      
      // å¯åŠ¨å†·å´
      cooldownActive = true;
      setTimeout(() => {
        cooldownActive = false;
      }, 2000); // 2ç§’å†·å´æ—¶é—´
      
      // æ˜¾ç¤ºloadingçŠ¶æ€
      sendButton.disabled = true;
      const originalButtonText = sendButton.textContent;
      sendButton.innerHTML = '<span class="loading-indicator"></span>å‘é€ä¸­';
      
      // åˆ›å»º"æ€è€ƒä¸­"çš„ä¸´æ—¶æ¶ˆæ¯
      const thinkingElement = document.createElement('div');
      thinkingElement.classList.add('message', 'latest', 'thinking-message');
      
      // åˆ›å»ºæ€è€ƒä¸­çš„åŠ¨ç”»å†…å®¹
      const thinkingContent = document.createElement('div');
      thinkingContent.className = 'thinking-content';
      thinkingContent.innerHTML = '<span class="thinking-dot"></span><span class="thinking-dot"></span><span class="thinking-dot"></span>';
      
      // æ·»åŠ æ€è€ƒä¸­æ ‡ç­¾
      const thinkingLabel = document.createElement('div');
      thinkingLabel.className = 'message-label';
      thinkingLabel.textContent = 'æ€è€ƒä¸­';
      
      thinkingElement.appendChild(thinkingLabel);
      thinkingElement.appendChild(thinkingContent);
      
      // æ·»åŠ åˆ°ç•Œé¢
      outputArea.appendChild(thinkingElement);
      scrollToBottom();
      
      try {
        // å‘é€POSTè¯·æ±‚åˆ°API
        const response = await fetch(CONFIG.API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${CONFIG.API_TOKEN}`
          },
          body: JSON.stringify({
            bot_id: CONFIG.BOT_ID,
            query: message,
            user: 'test-user'
          })
        });
        
        // æ£€æŸ¥å“åº”çŠ¶æ€
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        // è§£æJSONå“åº”
        const data = await response.json();
        
        // åœ¨debugåŒºåŸŸæ˜¾ç¤ºå®Œæ•´å“åº”
        debugArea.textContent = JSON.stringify(data, null, 2);
        
        // === å“åº”è§£æé€»è¾‘ ===
        let agentReply = '';
        
        // å¤„ç†å·¥ä½œæµæ ¼å¼çš„å“åº”
        if (data && data.messages && Array.isArray(data.messages)) {
          console.log("æ£€æµ‹åˆ°å·¥ä½œæµæ ¼å¼å“åº”ï¼Œæ¶ˆæ¯æ•°é‡:", data.messages.length);
          
          // ç›´æ¥æŸ¥æ‰¾roleä¸º"answer"çš„æ¶ˆæ¯
          const answerMsg = data.messages.find(msg => msg.role === "answer");
          if (answerMsg && answerMsg.content) {
            agentReply = answerMsg.content;
            console.log("æ‰¾åˆ°answeræ¶ˆæ¯:", agentReply.substring(0, 50) + "...");
          } 
          // å¤‡é€‰ï¼šæŸ¥æ‰¾åŒ…å«å®é™…å›å¤å†…å®¹çš„æ¶ˆæ¯
          else {
            for (const msg of data.messages) {
              if (msg.content && typeof msg.content === 'string' && msg.content.length > 30) {
                console.log("å°è¯•ä½¿ç”¨æ¶ˆæ¯:", msg.role, msg.content.substring(0, 30) + "...");
                // é€‰æ‹©çœ‹èµ·æ¥åƒå›å¤å†…å®¹çš„æ¶ˆæ¯
                if (!msg.content.includes("plugin_id") && !msg.content.startsWith('{"')) {
                  agentReply = msg.content;
                  break;
                }
              }
            }
          }
        }
        
        // å¤‡é€‰æ–¹æ¡ˆï¼šå¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„æ¶ˆæ¯ï¼Œå°è¯•ä»æ•´ä¸ªå“åº”ä¸­æå–
        if (!agentReply && data.msg === "success") {
          console.log("ä½¿ç”¨å¤‡é€‰æå–æ–¹æ³•");
          // å°†æ•´ä¸ªå“åº”è½¬ä¸ºå­—ç¬¦ä¸²
          const fullResponseStr = JSON.stringify(data);
          // å°è¯•æå–çœ‹èµ·æ¥åƒå›å¤çš„å†…å®¹
          const contentMatches = fullResponseStr.match(/"content"\s*:\s*"([^"]{20,})"/);
          if (contentMatches && contentMatches[1]) {
            agentReply = contentMatches[1];
          }
        }
        
        // å¦‚æœä»ç„¶æ‰¾ä¸åˆ°å†…å®¹ï¼Œä½¿ç”¨å¤‡ç”¨æ¶ˆæ¯
        if (!agentReply) {
          throw new Error("æ— æ³•ä»å“åº”ä¸­æå–å›å¤å†…å®¹");
        }
        
        console.log("æå–çš„åŸå§‹å†…å®¹é•¿åº¦:", agentReply.length);
        
        // å†…å®¹æ¸…ç†
        let cleanReply = agentReply
          // ç§»é™¤HTMLæ ‡ç­¾
          .replace(/<[^>]*>/g, '')
          // å¤„ç†åŸºæœ¬è½¬ä¹‰å­—ç¬¦
          .replace(/\\n/g, '\n')
          .replace(/\\"/g, '"')
          .replace(/\\\\/g, '\\')
          // ç§»é™¤å¤šä½™çš„åæ–œæ 
          .replace(/\\/g, '')
          // é€‚å½“æ•´ç†æ ¼å¼
          .replace(/\n{3,}/g, '\n\n')
          // ç§»é™¤é¦–å°¾ç©ºç™½
          .trim();
        
        console.log("æ¸…ç†åçš„å†…å®¹é•¿åº¦:", cleanReply.length);
        
        // ç¡®ä¿å†…å®¹éç©º
        if (!cleanReply || cleanReply.length < 5) {
          throw new Error("æ¸…ç†åçš„å›å¤å†…å®¹ä¸ºç©ºæˆ–è¿‡çŸ­");
        }
        
        // ç§»é™¤æ€è€ƒä¸­æ¶ˆæ¯
        if (thinkingElement.parentNode) {
          outputArea.removeChild(thinkingElement);
        }
        
        // æ·»åŠ AIå›å¤åˆ°å†å²è®°å½•
        addMessageToHistory(`ã€ç­”ã€‘${cleanReply}`);
        
      } catch (error) {
        console.error('Error:', error);
        
        // æ·»åŠ é”™è¯¯æ¶ˆæ¯åˆ°å†å²è®°å½•
        addMessageToHistory(`ã€ç³»ç»Ÿã€‘å‡ºé”™äº†: ${error.message}`);
        
        // æ›´æ–°éšè—ç»“æœ
        hiddenResult.value = '';
      } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        sendButton.disabled = false;
        sendButton.innerHTML = originalButtonText;
      }
    }

    // æ¸…ç©ºèŠå¤©è®°å½•
    function clearMessages() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿ')) {
        outputArea.innerHTML = '';
        messageHistory.length = 0;
        hiddenResult.value = '';
        debugArea.textContent = '';
      }
    }

    // è¡¨å•æäº¤äº‹ä»¶å¤„ç†
    messageForm.addEventListener('submit', function(event) {
      event.preventDefault();
      const message = userInput.value.trim();
      if (!message) return;
      
      // æ·»åŠ ç”¨æˆ·é—®é¢˜åˆ°å†å²è®°å½•
      addMessageToHistory(`ã€é—®ã€‘${message}`);
      
      // æ¸…ç©ºè¾“å…¥æ¡†å¹¶èšç„¦ - ç¡®ä¿è¿™è¡Œä»£ç æ‰§è¡Œ
      userInput.value = '';
      userInput.focus();
      
      // å‘é€æ¶ˆæ¯åˆ°API
      sendMessage(message);
    });

    // åˆ·æ–°æŒ‰é’®äº‹ä»¶å¤„ç†
    refreshButton.addEventListener('click', function() {
      clearMessages();
      userInput.focus();
    });

    // æ”¯æŒEnteré”®å‘é€æ¶ˆæ¯
    userInput.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        messageForm.dispatchEvent(new Event('submit'));
      }
    });

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œåªæœ‰åœ¨æ˜¾ç¤ºæ–°æ¶ˆæ¯æ—¶æ‰æ»šåŠ¨
    window.addEventListener('resize', function() {
      // çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œä¸è‡ªåŠ¨æ»šåŠ¨
      // åªæœ‰åœ¨æ˜¾ç¤ºæ–°æ¶ˆæ¯æ—¶æ‰æ»šåŠ¨
    });

    // åœ¨é¡µé¢åŠ è½½æ—¶è®¾ç½®
    window.addEventListener('load', function() {
      userInput.focus();
      
      // ä¿ç•™åŸºæœ¬æ ·å¼æ›´æ–°
      updateScrollStyles();
      
      // é»˜è®¤éšè—DebugåŒºåŸŸ
      debugArea.style.display = 'none';
      toggleDebug.textContent = 'æ˜¾ç¤ºDebugä¿¡æ¯ â–¼';
      
      // é¢„åŠ è½½å¸¸ç”¨è¡¨æƒ…ç¬¦å·
      const emojiPreload = document.createElement('div');
      emojiPreload.style.opacity = '0';
      emojiPreload.style.position = 'absolute';
      emojiPreload.style.pointerEvents = 'none';
      emojiPreload.innerHTML = 'ğŸ‘ğŸ‘ğŸ™‚ğŸ™â“âœ…âŒ';
      document.body.appendChild(emojiPreload);
      setTimeout(() => emojiPreload.remove(), 1000);
    });
  </script>
</body>
</html>
